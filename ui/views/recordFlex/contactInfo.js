/*
 View: contactInfo
WARNING! This file is generated by Slingr. You shouldn't add new functions or delete the functions
manually unless you know what you are doing. To be safe, only modify the scripts inside functions.
*/

function personalInfoTableWidgetCalculation(record, options) {
    let columns = [
        {
            label: 'Attribute',
            name: 'attribute'
        },
        {
            label: 'Value',
            name: 'value'
        }
    ];
    let nationalityInfo = svc.http.get({url: 'https://api.nationalize.io/?name=' + record.field('fullName').val()});
    let nationality = nationalityInfo.country[0].country_id;
    let genderInfo = svc.http.get({url: 'https://api.genderize.io?name=' + record.field('fullName').val()});
    let gender = genderInfo.gender
    let ageInfo = svc.http.get({url: 'https://api.agify.io/?name=' + record.field('fullName').val()});
    let age = ageInfo.age;
    return {
        header: [
            {name: "attribute", label: "Attribute", options: {style: {fontWeight: "bold"}}},
            {name: "value", label: "Value", options: {style: {fontWeight: "bold"}}}
        ],
        rows: [
            {
                cells: [
                    {
                        headerName: 'attribute',
                        value: "Nationality"
                    },
                    {
                        headerName: 'value',
                        value: nationality
                    }
                ]
            },
            {
                cells: [
                    {
                        headerName: 'attribute',
                        value: "Gender"
                    },
                    {
                        headerName: 'value',
                        value: gender
                    }
                ]
            },
            {
                cells: [
                    {
                        headerName: 'attribute',
                        value: "Age"
                    },
                    {
                        headerName: 'value',
                        value: age
                    }
                ]
            }
        ]
    };
}

function notesTableWidgetCalculation(record, options) {
    let rows = [];
    let filters = options.filters || {};
    let notes = record.field('notes').val();
    let from = options.from || 0;
    let to = options.to || notes.length;
    // apply filtering based on the 'note' column
    notes = notes.filter(function (noteItem) {
        let noteValue = noteItem.note
        if (filters.note && noteValue.toLowerCase().includes(filters.note.toLowerCase())) {
            return true;
        }
        return !filters.note;
    });
    // retrieve only the requested batch
    let notesBatch = notes.slice(from, to);
    notesBatch.forEach(function (noteItem) {
        rows.push({
            cells: [
                {headerName: "user", value: noteItem.user},
                {headerName: "note", value: noteItem.note}
            ]
        });
    });
    return {
        header: [
            {name: "user", label: "User", options: {style: {fontWeight: "bold"}}},
            {name: "note", label: "Note", options: {style: {fontWeight: "bold"}}}
        ],
        body: rows
    };
}
